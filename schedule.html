<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento Dinâmico</title>
    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Oswald:wght@600&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Incluindo o CSS do Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Template Stylesheet -->
    <link rel="stylesheet" href="css/schedule.css">

    <!-- JQuery Mask Plugin-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    
</head>
<body>
    

    <!-- Navbar Start -->
    <nav class="navbar navbar-expand-lg bg-secondary navbar-dark sticky-top py-lg-0 px-lg-5 wow fadeIn" data-wow-delay="0.1s">
        <a href="index.html" class="navbar-brand ms-4 ms-lg-0"> </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto p-4 p-lg-0">
                <a href="index.html" class="nav-item nav-link active">Início</a>
                <a href="about.html" class="nav-item nav-link">Sobre</a>
                <a href="service.html" class="nav-item nav-link">Serviços</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                    <div class="dropdown-menu m-0">
                        <a href="price.html" class="dropdown-item">Plano de Preços</a>
                        <a href="team.html" class="dropdown-item">Nosso Barbeiro</a>
                        <a href="open.html" class="dropdown-item">Horário de Funcionamento</a>
                        <a href="testimonial.html" class="dropdown-item">Depoimentos</a>
                        <a href="404.html" class="dropdown-item">404 Page</a>
                    </div>
                </div>
                <a href="andress.html" class="nav-item nav-link">Endereço</a>
            </div>
            <a href="admin-login.html" class="btn btn-primary rounded-0 py-2 px-lg-4">Área Administrativa <i class="fa fa-user-shield ms-3"></i></a>
        </div>
    </nav>
    <!-- Navbar End -->

    <header>
        <h1>
            <span class="image-text">
                <img src="IMG_0950.PNG" alt="Francisco Barbearia">
            </span>
        </h1>
    </header>
<main>
    <section id="schedule">
        <h2>Agendamento</h2>
        <form id="booking-form">
            <label for="client_name">Seu Nome:</label>
            <input type="text" id="client_name" name="client_name" placeholder="Digite seu nome" required autocomplete="off">

            <label for="whatsapp">Número de WhatsApp:</label>
            <input type="tel" id="whatsapp" name="whatsapp" placeholder="Digite seu número de WhatsApp com DDD" required autocomplete="off">

            <label for="service">Escolha o serviço:</label>
            <select name="service" id="service" required>
                <option value="" disabled selected>Selecione um serviço</option>
                <option value="Corte Social">Corte Social</option>
                <option value="Corte Degradê">Corte Degradê</option>
                <option value="Corte Social + Barba">Corte Social + Barba</option>
                <option value="Corte Degradê + Barba">Corte Degradê + Barba</option>
                <option value="Corte Degradê + Pigmentação">Corte Degradê + Pigmentação</option>
                <option value="Corte Social + Pigmentação">Corte Social + Pigmentação</option>
                <option value="Barba + Pigmentação">Barba + Pigmentação</option>
                <option value="Corte Degradê + Luzes">Corte Degradê + Luzes</option>
                <option value="Corte Degradê + Nevou">Corte Degradê + Nevou</option>
                <option value="Corte Social + Luzes">Corte Social + Luzes</option>
                <option value="Corte Social + Nevou">Corte Social + Nevou</option>
            </select>
    
            <label for="date">Selecione a data:</label>
            <input type="text" id="date" name="date" placeholder="Escolha uma data" required>
    
            <label for="time">Escolha o horário:</label>
            <select name="time" id="time" required>
                <option value="" disabled selected>Escolha um horário</option>
                <option value="08:00">08:00</option>
                <option value="08:30">08:30</option>
                <option value="09:00">09:00</option>
                <option value="09:30">09:30</option>
                <option value="10:00">10:00</option>
                <option value="10:30">10:30</option>
                <option value="11:00">11:00</option>
                <option value="11:30">11:30</option>
                <option value="12:00">12:00</option>
                <option value="14:00">14:00</option>
                <option value="14:30">14:30</option>
                <option value="15:00">15:00</option>
                <option value="15:30">15:30</option>
                <option value="16:00">16:00</option>
                <option value="16:30">16:30</option>
                <option value="17:00">17:00</option>
                <option value="17:30">17:30</option>
                <option value="18:00">18:00</option>
                <option value="18:30">18:30</option>
            </select>
    
            <button type="submit">Agendar</button>
        </form>
    </section>
    
</main>
<!-- Footer Start -->
<div class="container-fluid bg-secondary text-light footer mt-5 pt-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="container py-5">
        <div class="row g-5">
            <div class="col-lg-4 col-md-6">
                <h4 class="text-uppercase mb-4">Get In Touch</h4>
                <div class="d-flex align-items-center mb-2">
                    <div class="btn-square bg-dark flex-shrink-0 me-3">
                        <span class="fa fa-map-marker-alt text-primary"></span>
                    </div>
                    <span>AV. Elisa Maciel Santiago, 2623 - CE</span>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <div class="btn-square bg-dark flex-shrink-0 me-3">
                        <span class="fa fa-phone-alt text-primary"></span>
                    </div>
                    <span>+55 88 9306-1660</span>
                </div>
                <div class="d-flex align-items-center">
                    <div class="btn-square bg-dark flex-shrink-0 me-3">
                        <span class="fa fa-envelope-open text-primary"></span>
                    </div>
                    <span>info@example.com</span>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <h4 class="text-uppercase mb-4">Quick Links</h4>
                <a class="btn btn-link" href="">About Us</a>
                <a class="btn btn-link" href="">Contact Us</a>
                <a class="btn btn-link" href="">Our Services</a>
                <a class="btn btn-link" href="">Terms & Condition</a>
                <a class="btn btn-link" href="">Support</a>
            </div>
            <div class="col-lg-4 col-md-6">
                <h4 class="text-uppercase mb-4">Newsletter</h4>
                <div class="position-relative mb-4">
                    <input class="form-control border-0 w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                    <button type="button" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">SignUp</button>
                </div>
                <div class="d-flex pt-1 m-n1">
                    <a class="btn btn-lg-square btn-dark text-primary m-1" href="https://www.instagram.com/franciscobarbeir?igsh=ZHF4M2I5eDVuazBj&utm_source=qr">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a class="btn btn-lg-square btn-dark text-primary m-1" href=""><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="copyright">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    &copy; <a class="border-bottom" href="#">Francisco Barbearia</a>, All Right Reserved.
                </div>
                <div class="col-md-6 text-center text-md-end">
                    Designed By <a class="border-bottom" href="https://victordeveloper-dg33v6f.gamma.site/">Victor de Lima</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Footer End -->


<!-- Back to Top -->
<a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>


<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="lib/wow/wow.min.js"></script>
<script src="lib/easing/easing.min.js"></script>
<script src="lib/waypoints/waypoints.min.js"></script>
<script src="lib/owlcarousel/owl.carousel.min.js"></script>
<!-- Incluindo o JS do Flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Template Javascript -->
<script src="js/main.js"></script> 
<script src="js/schedule.js"></script>
<!-- Incluindo a biblioteca Flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<!-- Incluindo o arquivo de locale para português -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    // Quando a página carregar completamente, rolar até o formulário de agendamento
    const bookingForm = document.getElementById("booking-form");

    if (window.location.hash === "#schedule") {
        setTimeout(() => {
            bookingForm.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 100); // Pequeno delay para garantir que tudo carregou
    }
})
    ;document.addEventListener("DOMContentLoaded", function () {
    // Verifica se a URL contém "#schedule"
        if (window.location.hash === "#schedule") {
        const bookingForm = document.getElementById("booking-form");

        if (bookingForm) {
            // Faz a rolagem automática para o formulário
            bookingForm.scrollIntoView({ behavior: "smooth", block: "start" });
        }
    }
});
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Obtendo a data atual e configurando para o início do dia (sem horas)
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Reseta as horas para garantir a comparação correta
        
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1); // Incrementa o dia para o dia seguinte
        tomorrow.setHours(0, 0, 0, 0); // Zera as horas para garantir a comparação
        
        // Inicializando o Flatpickr
        flatpickr("#date", {
            dateFormat: "Y-m-d", // Formato da data (ano-mês-dia)
            minDate: today,      // Definindo o dia de hoje como a data mínima
            maxDate: tomorrow,   // Definindo o dia seguinte como a data máxima
            locale: "pt",        // Idioma português
            
            disable: [
                function(date) {
                    // Desabilita os domingos
                    return date.getDay() === 0; // O valor 0 representa o domingo
                }
            ],
            
            onDayCreate: function(dObj, dStr, instance) {
                // Marcando os dias disponíveis com a classe .available
                if (dObj >= today && dObj <= tomorrow && dObj.getDay() !== 0) {
                    dObj.classList.add("available");
                }
            }
        });
    });
</script>
<script>
    $(document).ready(function() {
    // Máscara para o campo de WhatsApp (formato: (XX) XXXXX-XXXX)
    $("#whatsapp").mask("(00) 00000-0000");

    // Validação do formulário (ainda inclui a validação do WhatsApp)
    $("#booking-form").on("submit", function(event) {
        event.preventDefault(); // Impede o envio padrão do formulário

        const clientName = $("#client_name").val();
        const date = $("#date").val();
        const time = $("#time").val();
        const whatsapp = $("#whatsapp").val();
        const service = $("#service").val(); // Obtém o valor do serviço selecionado

        // Remover espaços extras dos inputs
        const cleanClientName = clientName.trim();
        const cleanDate = date.trim();
        const cleanTime = time.trim();
        const cleanWhatsapp = whatsapp.trim();

        // Debugando os valores após limpeza
        console.log("Nome do cliente (limpo):", cleanClientName);
        console.log("Data (limpa):", cleanDate);
        console.log("Hora (limpa):", cleanTime);
        console.log("WhatsApp (limpo):", cleanWhatsapp);
        console.log("Serviço escolhido:", service);

        // Validando se todos os campos estão preenchidos
        if (!cleanClientName || !cleanDate || !cleanTime || !cleanWhatsapp || !service) {
            alert("Todos os campos são obrigatórios.");
            return;
        }

        // Montando os dados a serem enviados
        const data = {
            client_name: cleanClientName,
            date: cleanDate,
            time: cleanTime,
            whatsapp: cleanWhatsapp,
            service: service // Adicionando o serviço ao objeto de dados
        };

        console.log("Dados realmente enviados para o backend:", JSON.stringify(data, null, 2));

        // Enviando dados para o backend usando fetch
        fetch("https://franciscobarbearia.netlify.app/.netlify/functions/appointments", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(response => response.text())
        .then(text => {
            try {
                const responseData = JSON.parse(text);
                console.log("Resposta do servidor:", responseData);

                if (responseData.error) {
                    $("#response-message").html(`<div class="alert alert-danger">${responseData.error}</div>`);
                } else {
                    $("#response-message").html(`<div class="alert alert-success">${responseData.message}</div>`);
                    $("#booking-form")[0].reset(); // Limpa o formulário após o envio
                    
                    // Atualiza a tabela de agendamentos
                    const newRow = `
                        <tr>
                            <td>${cleanClientName}</td>
                            <td>${cleanDate}</td>
                            <td>${cleanTime}</td>
                            <td>${service}</td> <!-- Exibindo o serviço na tabela -->
                            <td>
                                <a href="#" class="btn btn-primary btn-sm">
                                    <i class="fas fa-edit"></i> Editar
                                </a>
                                <a href="https://franciscobarbearia.netlify.app/.netlify/functions/delete_appointment" class="btn btn-danger btn-sm">
                                    <i class="fas fa-trash"></i> Excluir
                                </a>
                            </td>
                        </tr>`;
                    $(".appointments-table tbody").append(newRow);
                }
            } catch (e) {
                console.error("Erro ao parsear JSON:", e);
                $("#response-message").html(`<div class="alert alert-danger">Resposta inesperada do servidor.</div>`);
            }
        })
        .catch(error => {
            console.error("Erro ao enviar o agendamento:", error);
            $("#response-message").html(`<div class="alert alert-danger">Erro ao enviar o agendamento. Tente novamente.</div>`);
        });
    });
});



 </script>

</body>
</html>